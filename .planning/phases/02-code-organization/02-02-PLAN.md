---
phase: 02-code-organization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - R/01_representations_classes.R
  - R/02_templates.R
  - R/03_properties_autocov.R
  - R/03_properties_frequency.R
  - R/03_properties_impulse.R
  - R/03_properties_poles.R
  - R/03_properties_spectral.R
  - R/04_timeseries_predict.R
  - R/04_timeseries_simulate.R
  - R/04_timeseries_solve.R
  - R/05_estimation_ar.R
  - R/05_estimation_arma_hrk.R
  - R/05_estimation_likelihood.R
  - R/05_estimation_particle.R
  - R/05_estimation_rls.R
  - R/05_estimation_subspace.R
  - R/06_visualization_plot.R
  - R/06_visualization_plot_prediction.R
  - R/07_comparison_metrics.R
  - R/08_utilities_data.R
  - R/08_utilities_print.R
  - R/08_utilities_str.R
  - NAMESPACE
autonomous: true

must_haves:
  truths:
    - "R files follow numeric prefix convention consistently (01_*, 02_*, etc.)"
    - "S3 methods are properly organized by generic function (current pattern maintained)"
    - "All S3 methods have proper @export tags with full method names"
    - "NAMESPACE contains correct S3method() entries for all exported methods"
    - "rldm parent class methods exist where appropriate for inheritance"
  artifacts:
    - path: "R/01_representations_classes.R"
      provides: "Model class definitions (armamod, stspmod, rmfdmod) inheriting from rldm"
      contains: "class definitions with proper inheritance"
    - path: "R/03_properties_autocov.R"
      provides: "autocov() S3 methods for all model classes"
      contains: "@export autocov.armamod, @export autocov.stspmod, etc."
    - path: "NAMESPACE"
      provides: "S3 method registration"
      contains: "S3method(autocov,armamod), S3method(autocov,stspmod), etc."
    - path: "Multiple R files in 03_properties_*, 04_timeseries_*, etc."
      provides: "S3 methods organized by generic function"
      pattern: "Files grouped by operation type not object type"
  key_links:
    - from: "S3 method definitions in R files"
      to: "NAMESPACE S3method() entries"
      via: "Roxygen @export tags"
      pattern: "@export autocov\\.[a-z]+"
    - from: "rldm parent class"
      to: "armamod, stspmod, rmfdmod child classes"
      via: "inheritance in class definitions"
      pattern: "class.*armamod.*rldm"
    - from: "Generic function organization"
      to: "File naming convention"
      via: "Numeric prefix system"
      pattern: "03_properties_.*\\.R for property methods"
---

<objective>
Review R file organization and S3 method structure to ensure consistency with numeric prefix convention and proper S3 registration.

Purpose: Verify that the numeric prefix file organization (01_*, 02_*, etc.) is consistently followed and that S3 methods are properly organized by generic function with correct @export tags and NAMESPACE registration.

Output: Confirmation that R files follow the established organization pattern, S3 methods are correctly registered, and the rldm inheritance hierarchy is properly implemented.

Note: This plan performs review and analysis only - files listed in files_modified are examined for consistency but not modified.
</objective>

<execution_context>
@/home/bernd/.claude/get-shit-done/workflows/execute-plan.md
@/home/bernd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-organization/02-RESEARCH.md
@.planning/phases/02-code-organization/02-CONTEXT.md

# R file organization from research
- Current organization by generic function is recommended (all autocov.* methods in one file)
- Numeric prefix system: 01=representations, 02=templates, 03=properties, 04=timeseries, 05=estimation, 06=visualization, 07=comparison, 08=utilities
- S3 methods should use @export with full method names (autocov.armamod)
- rldm is parent class for armamod, stspmod, rmfdmod
- NAMESPACE should be generated by Roxygen, not manually edited
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify numeric prefix convention and file organization</name>
  <files>R/01_representations_classes.R, R/02_templates.R, R/03_properties_*.R, R/04_timeseries_*.R, R/05_estimation_*.R, R/06_visualization_*.R, R/07_comparison_metrics.R, R/08_utilities_*.R</files>
  <action>
1. Examine all R files in the R/ directory and verify they follow the numeric prefix convention:
   - 01_*: Representations and class definitions (armamod, stspmod, rmfdmod)
   - 02_*: Parameter templates (tmpl_* functions, fill_template, extract_theta)
   - 03_*: Properties (autocov, freqresp, impresp, poles, spectrald)
   - 04_*: Timeseries operations (solve_de, sim, predict)
   - 05_*: Estimation methods (AR, ARMA, likelihood, particle filter, RLS, subspace)
   - 06_*: Visualization (plot methods)
   - 07_*: Comparison metrics (KL_divergence, pm_test, compare_estimates)
   - 08_*: Utilities (print, str, data documentation)

2. Check for any files that don't follow this convention:
   - RcppExports.R (auto-generated, correct as exception)
   - RLDM-package.R (package documentation, correct as exception)

3. Verify that files within each category are logically grouped:
   - 03_properties_*.R should contain property methods (autocov, freqresp, etc.)
   - 04_timeseries_*.R should contain timeseries operations
   - etc.

4. Document any inconsistencies found but DO NOT rename files unless absolutely necessary (per phase context: "preference for leaving as exceptions when justified").

5. Create a summary of the current organization structure.
  </action>
  <verify>
- List all R files and their prefixes
- Verify each file's content matches its prefix category
- Check for any major inconsistencies in the naming convention
- Confirm that RcppExports.R and RLDM-package.R are the only exceptions
  </verify>
  <done>
- Complete understanding of current R file organization
- Documentation of any naming convention inconsistencies
- Confirmation that the numeric prefix system is generally followed
  </done>
</task>

<task type="auto">
  <name>Task 2: Review S3 method organization and registration</name>
  <files>R/03_properties_autocov.R, R/03_properties_frequency.R, R/03_properties_impulse.R, R/03_properties_poles.R, R/03_properties_spectral.R, R/04_timeseries_predict.R, R/04_timeseries_simulate.R, R/04_timeseries_solve.R, R/06_visualization_plot.R, R/06_visualization_plot_prediction.R, R/08_utilities_print.R, R/08_utilities_str.R, NAMESPACE</files>
  <action>
1. Examine S3 method organization pattern:
   - Check that methods are organized by generic function (all autocov.* methods in 03_properties_autocov.R)
   - Verify this pattern holds for other generics: freqresp, impresp, poles, spectrald, plot, print, str, etc.

2. Check S3 method registration:
   - For each S3 method file, verify methods have `@export` tags with full method names (e.g., `@export autocov.armamod`)
   - Check that `@rdname` tags are used appropriately to group documentation
   - Verify that default methods exist where appropriate (e.g., `autocov.default`)

3. Examine NAMESPACE file:
   - Verify it contains `S3method()` entries for all exported S3 methods
   - Check that entries match the method names in R files
   - Confirm NAMESPACE is auto-generated (not manually edited)

4. Check rldm inheritance:
   - Verify `armamod`, `stspmod`, `rmfdmod` classes inherit from `rldm`
   - Check if `rldm` default methods exist for key generics
   - Ensure inheritance hierarchy is properly implemented

5. Document findings and note any issues with S3 registration.
  </action>
  <verify>
- Check sample S3 method files for proper @export tags
- Verify NAMESPACE contains corresponding S3method() entries
- Test that `devtools::document()` would regenerate NAMESPACE correctly
- Confirm inheritance structure in class definitions
  </verify>
  <done>
- Understanding of current S3 method organization (by generic function)
- Verification of proper @export tags and NAMESPACE registration
- Confirmation of rldm inheritance hierarchy
- Documentation of any S3 registration issues found
  </done>
</task>

<task type="auto">
  <name>Task 3: Analyze and document current organization strategy</name>
  <files>R/01_representations_classes.R, R/03_properties_autocov.R, NAMESPACE</files>
  <action>
1. Based on Tasks 1 and 2 findings, analyze the current organization strategy:
   - Confirm that S3 methods are organized by generic function (not by class)
   - Evaluate if this organization makes sense for the package's use cases
   - Check if any methods are missing from expected files

2. Document the current strategy with examples:
   - Show how autocov methods are organized (all in one file)
   - Show how different model classes implement the same generic
   - Demonstrate the inheritance pattern

3. Check for any hybrid cases (files with multiple purposes):
   - Identify any files that don't fit cleanly into the numeric prefix categories
   - Document why these exceptions exist

4. Create a summary report of the R code organization:
   - Numeric prefix convention compliance
   - S3 method organization strategy
   - Registration completeness
   - Inheritance implementation
   - Any exceptions or inconsistencies

5. Make recommendations ONLY if critical issues are found (per phase context: creating new functionality is out of scope).
  </action>
  <verify>
- Create a clear summary of the current organization approach
- Document any exceptions to the standard patterns
- Verify that the organization supports maintainability
- Check that all key generics have methods for all appropriate classes
  </verify>
  <done>
- Comprehensive understanding of R code organization
- Documentation of current S3 method strategy
- Summary of any organizational issues found
- Clear picture of what works well in the current structure
  </done>
</task>

</tasks>

<verification>
1. Run `devtools::document()` to ensure NAMESPACE can be regenerated without errors
2. Check that `devtools::load_all()` works correctly with current S3 method organization
3. Verify that a sample S3 method call works: `autocov(test_armamod())` should execute without "no applicable method" errors
</verification>

<success_criteria>
- [x] Numeric prefix convention is documented and understood
- [x] S3 method organization strategy (by generic function) is confirmed
- [x] @export tags and NAMESPACE registration are verified
- [x] rldm inheritance hierarchy is checked
- [x] Package documentation regenerates without errors
- [x] No organizational changes made (analysis only, per phase scope)
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-organization/02-02-SUMMARY.md`
</output>