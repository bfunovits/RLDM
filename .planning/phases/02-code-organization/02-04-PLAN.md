---
phase: 02-code-organization
plan: 04
type: execute
wave: 2
depends_on: ["01", "02", "03"]
files_modified:
  - src/kf.cpp
  - src/rls_core.cpp
  - src/solve_fwd_bwd_cll.cpp
  - src/pf.cpp
  - src/.gitignore
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Build artifacts (*.o, *.so, *.dll) are removed from src/ directory"
    - ".gitignore patterns prevent future build artifact commits"
    - "C++ code documentation and style improvements are complete"
    - "Package builds cleanly from source"
    - "All Phase 2 requirements (CODE-01 to CODE-04) are verified"
  artifacts:
    - path: "src/"
      provides: "C++ source code without build artifacts"
      contains: "Only .cpp files, .gitignore, Makevars* (no *.o, *.so, *.dll)"
    - path: "src/.gitignore"
      provides: "Build artifact exclusion for src/ directory"
      contains: "*.o, *.so, *.dll patterns"
    - path: ".gitignore"
      provides: "Global build artifact exclusion"
      contains: "src/*.o, src/*.so, src/*.dll or reference to src/.gitignore"
  key_links:
    - from: "Build artifact cleanup"
      to: ".gitignore patterns"
      via: "Prevention of future accidental commits"
      pattern: "*.o, *.so, *.dll in .gitignore"
    - from: "C++ code improvements"
      to: "Phase 2 requirements"
      via: "Verification against CODE-01 to CODE-04"
      pattern: "Requirements traceability"
    - from: "Clean src/ directory"
      to: "Package build process"
      via: "Source-only distribution"
      pattern: "No binary artifacts in source"
---

<objective>
Clean up build artifacts from src/ directory, verify .gitignore patterns, and perform final verification that all Phase 2 code organization requirements are met.

Purpose: Ensure a clean source directory free of build artifacts, confirm proper git exclusion patterns are in place, and verify that all code organization improvements (C++ documentation, R file consistency, S3 organization, dependency management) are complete and working.

Output: Clean src/ directory, proper .gitignore configuration, and verification that Phase 2 requirements CODE-01 through CODE-04 are satisfied.
</objective>

<execution_context>
@/home/bernd/.claude/get-shit-done/workflows/execute-plan.md
@/home/bernd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-organization/02-RESEARCH.md
@.planning/phases/02-code-organization/02-CONTEXT.md

# Build artifact cleanup from research
- Remove *.o, *.so, *.dll files from src/ directory
- Ensure src/.gitignore has correct patterns (*.o, *.so, *.dll)
- Verify .gitignore references or includes src/.gitignore patterns
- Use devtools::clean_dll() for Rcpp cleanup if needed
- Phase 2 requirements: CODE-01 (C++ cleanup), CODE-02 (R file consistency), CODE-03 (S3 organization), CODE-04 (DESCRIPTION dependencies)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean build artifacts from src/ directory</name>
  <files>src/kf.cpp, src/rls_core.cpp, src/solve_fwd_bwd_cll.cpp, src/pf.cpp, src/.gitignore</files>
  <action>
1. List all files in src/ directory and identify build artifacts:
   - *.o object files (kf.o, rls_core.o, solve_fwd_bwd_cll.o, pf.o, etc.)
   - *.so shared library files (RLDM.so)
   - *.dll Windows DLL files (RLDM.dll)
   - Any other binary/build artifacts

2. Remove all build artifacts:
   - Delete all *.o files
   - Delete *.so and *.dll files
   - Keep only: .cpp source files, .gitignore, Makevars, Makevars.win, RcppExports.cpp

3. Verify src/.gitignore contains correct patterns:
   - Check src/.gitignore has: `*.o`, `*.so`, `*.dll`
   - Add missing patterns if needed
   - Ensure patterns are correct for excluding build artifacts

4. Check .gitignore in root directory:
   - Verify it either includes src/.gitignore or has its own patterns
   - Add `src/*.o`, `src/*.so`, `src/*.dll` to root .gitignore if not already covered

5. Use R tools for cleanup if available:
   - Run `devtools::clean_dll()` to clean Rcpp artifacts
   - This may remove additional build artifacts

6. Final check: src/ should contain only source files and configuration, no build outputs.
  </action>
  <verify>
- List contents of src/ directory after cleanup
- Confirm no *.o, *.so, *.dll files remain
- Verify src/.gitignore has correct exclusion patterns
- Check root .gitignore also excludes build artifacts
- Ensure RcppExports.cpp and source .cpp files are preserved
  </verify>
  <done>
- src/ directory cleaned of all build artifacts
- .gitignore patterns prevent future accidental commits
- Only source files and build configuration remain
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify C++ code improvements (CODE-01)</name>
  <files>src/kf.cpp, src/rls_core.cpp, src/solve_fwd_bwd_cll.cpp, src/pf.cpp</files>
  <action>
1. Verify Doxygen documentation is complete for all C++ files:
   - Check kf.cpp has Doxygen comments (/** */) for all functions
   - Verify @param, @return, @brief tags are present
   - Check rls_core.cpp, solve_fwd_bwd_cll.cpp, pf.cpp similarly

2. Verify Google C++ Style Guide compliance:
   - Check 2-space indentation (no tabs)
   - Verify line length under 80 characters (with reasonable exceptions)
   - Confirm snake_case naming for functions and variables
   - Check brace style (same line for functions, new line for control)

3. Verify no Roxygen comments (//') remain for C++ function documentation:
   - Roxygen comments should only be for Rcpp exports: `// [[Rcpp::export]]`
   - Function documentation should be Doxygen style

4. Test compilation:
   - Run `Rcpp::compileAttributes()` to ensure no syntax errors
   - Try `devtools::load_all()` to verify C++ code compiles
   - Check for any compilation warnings

5. Document verification results for CODE-01 requirement.
  </action>
  <verify>
- Sample each C++ file to check Doxygen documentation
- Verify consistent formatting across all files
- Test compilation with `devtools::load_all()`
- Confirm CODE-01 (C++ code cleanup) is satisfied
  </verify>
  <done>
- C++ code has complete Doxygen documentation
- Code follows Google C++ Style Guide
- No Roxygen comments for C++ function documentation
- Code compiles without errors
- CODE-01 requirement verified
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify R organization and dependencies (CODE-02, CODE-03, CODE-04)</name>
  <files>DESCRIPTION, NAMESPACE, R/01_representations_classes.R, R/03_properties_autocov.R</files>
  <action>
1. Verify CODE-02 (R file numeric prefix consistency):
   - Check R/ directory files follow 01_, 02_, 03_, etc. convention
   - Confirm exceptions are justified (RcppExports.R, RLDM-package.R)
   - Document that numeric prefix system is consistently followed

2. Verify CODE-03 (S3 method organization and registration):
   - Check S3 methods are organized by generic function (e.g., all autocov.* in one file)
   - Verify @export tags with full method names (autocov.armamod)
   - Confirm NAMESPACE has correct S3method() entries
   - Test that `devtools::document()` regenerates NAMESPACE correctly

3. Verify CODE-04 (DESCRIPTION dependencies):
   - Check DESCRIPTION has version constraints for all dependencies
   - Verify unused imports are removed
   - Confirm rationalmatrices is in Depends with Remotes specification
   - Test that `devtools::check()` passes dependency checks

4. Run final verification tests:
   - `devtools::document()` - should succeed
   - `devtools::load_all()` - should load package without errors
   - Sample S3 method call: `autocov(test_armamod())` should work
   - Check package builds: `devtools::build()` should create source package

5. Document that CODE-02, CODE-03, CODE-04 requirements are satisfied.
  </action>
  <verify>
- Run `devtools::document()` and `devtools::load_all()`
- Test sample S3 method calls
- Verify DESCRIPTION has version constraints
- Check NAMESPACE is properly generated
- Confirm all Phase 2 requirements are met
  </verify>
  <done>
- CODE-02 verified: R files follow numeric prefix convention
- CODE-03 verified: S3 methods properly organized and registered
- CODE-04 verified: DESCRIPTION dependencies reviewed and updated
- Package loads and basic functions work
- All Phase 2 requirements satisfied
  </done>
</task>

</tasks>

<verification>
1. Final `devtools::check()` run (quick version): `devtools::check(document = FALSE, vignettes = FALSE)`
2. Verify package builds: `devtools::build()` creates RLDM_*.tar.gz source package
3. Confirm src/ directory is clean: `ls -la src/` shows no *.o, *.so, *.dll files
4. Test key functionality: Load package and run a simple example from documentation
</verification>

<success_criteria>
- [x] src/ directory clean of build artifacts (*.o, *.so, *.dll removed)
- [x] .gitignore patterns prevent future build artifact commits
- [x] C++ code has Doxygen documentation and follows Google C++ Style Guide (CODE-01)
- [x] R files follow numeric prefix convention (CODE-02)
- [x] S3 methods properly organized and registered (CODE-03)
- [x] DESCRIPTION dependencies have version constraints, unused imports removed (CODE-04)
- [x] Package builds cleanly from source
- [x] All Phase 2 requirements (CODE-01 to CODE-04) verified as complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-organization/02-04-SUMMARY.md`
</output>