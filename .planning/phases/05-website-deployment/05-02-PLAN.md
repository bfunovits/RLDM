---
phase: 05-website-deployment
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: [inst/_pkgdown.yml, .github/workflows/pkgdown.yaml]
autonomous: true

must_haves:
  truths:
    - "pkgdown website builds locally without errors"
    - "Changes are committed and ready for deployment"
  artifacts:
    - path: "docs/"
      provides: "Locally built website"
      contains: "index.html, reference/, articles/"
    - path: "git status"
      provides: "Committed configuration changes"
      shows: "clean working tree with pkgdown config changes committed"
  key_links:
    - from: "inst/_pkgdown.yml"
      to: "docs/ directory"
      via: "pkgdown::build_site() command"
      pattern: "successful build output"
    - from: "git commit"
      to: "GitHub Actions trigger"
      via: "push to main branch"
      pattern: "commit message includes website deployment"
---

<objective>
Test local pkgdown build with fixed configuration and commit changes for automatic deployment.

Purpose: Verify pkgdown builds successfully locally, then commit changes so GitHub Actions can automatically deploy updated website.
Output: Successful local build, committed configuration changes ready for deployment
</objective>

<execution_context>
@/home/bernd/.claude/get-shit-done/workflows/execute-plan.md
@/home/bernd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-website-deployment/05-CONTEXT.md
@.planning/phases/05-website-deployment/05-RESEARCH.md
@.planning/phases/05-website-deployment/05-01-SUMMARY.md

# Plan 05-01 fixed pkgdown configuration by removing invalid internal C++ function references
# GitHub Actions workflow was verified as correctly configured
# Now need to test local build and commit changes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test local pkgdown build with fixed configuration</name>
  <files>docs/</files>
  <action>
1. First, clean any existing docs/ directory to ensure fresh build:
   ```bash
   rm -rf docs/
   ```

2. Build the pkgdown website locally using the same command as GitHub Actions:
   ```bash
   Rscript -e "pkgdown::build_site_github_pages(new_process = FALSE, install = FALSE)"
   ```

3. Monitor for errors. The build should complete without "must be a known topic name or alias" errors.

4. If build fails:
   - Check error messages
   - Verify `inst/_pkgdown.yml` doesn't reference undocumented functions
   - Check for other configuration issues
   - Fix and retry

5. If build succeeds:
   - Verify docs/ directory was created with index.html
   - Check reference/ directory contains documentation pages
   - Verify no errors in build output

6. Test that the local website works by checking index.html structure:
   ```bash
   head -20 docs/index.html
   ```
  </action>
  <verify>pkgdown::build_site_github_pages() completes without errors and creates docs/ directory</verify>
  <done>Local pkgdown build successful, website generated in docs/ directory</done>
</task>

<task type="auto">
  <name>Task 2: Commit configuration changes</name>
  <files>inst/_pkgdown.yml, .github/workflows/pkgdown.yaml</files>
  <action>
1. Stage the configuration changes:
   ```bash
   git add inst/_pkgdown.yml
   # Also add .github/workflows/pkgdown.yaml if any modifications were made in Plan 05-01
   git add .github/workflows/pkgdown.yaml 2>/dev/null || true
   ```

2. Check git status to confirm only intended files are staged:
   ```bash
   git status
   ```

3. Create commit with descriptive message:
   ```bash
   git commit -m "$(cat <<'EOF'
fix(pkgdown): remove invalid internal C++ function references

Remove references to 10 internal C++ functions from pkgdown configuration:
- outputs_ARMA_cpp, outputs_STSP_cpp
- residuals_ARMA_cpp, residuals_STSP_cpp
- cll_theta_ARMA_cpp, cll_theta_STSP_cpp
- fbsolve_STSP_cpp, solve_rmfd_cpp
- ll_kf_theta_cpp
- rls_exp_cpp

These functions lack Rd documentation and caused "must be a known topic name" build errors.

Tested locally: pkgdown::build_site_github_pages() completes successfully.

Ready for automatic deployment via GitHub Actions.

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
   ```

4. Verify commit was created:
   ```bash
   git log --oneline -1
   ```

5. **DO NOT push automatically** - let user decide when to push to trigger GitHub Actions deployment
  </action>
  <verify>git commit succeeds with descriptive message, changes committed locally</verify>
  <done>Configuration changes committed locally, ready for push to trigger GitHub Actions deployment</done>
</task>

</tasks>

<verification>
1. pkgdown builds locally without errors
2. docs/ directory created with website files
3. Configuration changes committed with descriptive message
4. Working tree clean (no uncommitted changes)
</verification>

<success_criteria>
- Local pkgdown build successful (no "must be a known topic name" errors)
- Configuration changes committed with descriptive message
- Ready for user to push changes to trigger GitHub Actions deployment
</success_criteria>

<output>
After completion, create `.planning/phases/05-website-deployment/05-02-SUMMARY.md`
</output>
