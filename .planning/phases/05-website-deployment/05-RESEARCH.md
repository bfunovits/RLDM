# Phase 5: Website Deployment - Research

**Researched:** 2026-01-30
**Domain:** R package documentation websites with pkgdown
**Confidence:** HIGH (based on existing working infrastructure and official documentation)

## Summary

This research covers updating the existing pkgdown documentation website for the RLDM R package to reflect documentation improvements from Phase 4. The website infrastructure is already functional and deployed to GitHub Pages, with automatic builds via GitHub Actions.

**Key findings:**
- The website is already deployed at https://bfunovits.github.io/RLDM/ (redirects to https://berndfunovits.com/RLDM/)
- Current pkgdown configuration in `inst/_pkgdown.yml` references internal C++ functions that lack Rd documentation, causing build failures
- GitHub Actions workflow (`.github/workflows/pkgdown.yaml`) is correctly configured for automatic deployment
- The site was last built on 2026-01-18 with pkgdown 2.1.2
- MathJax integration is already configured for mathematical notation

**Primary recommendation:** Fix the pkgdown configuration by removing references to undocumented internal C++ functions, then rebuild the site locally to verify, and let GitHub Actions handle deployment.

## Standard Stack

The established tools for R package documentation websites:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| pkgdown | 2.1.2+ | Documentation website generation | Standard for R packages, integrates with Roxygen2 |
| GitHub Actions | Latest | Continuous deployment | Standard for automatic website builds |
| GitHub Pages | N/A | Static site hosting | Free hosting integrated with GitHub |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| devtools | Latest | Package development | For local builds and testing |
| usethis | Latest | Package setup | For initial pkgdown configuration |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| pkgdown | manual website | pkgdown is standard, automatic from documentation |
| GitHub Pages | Netlify, Vercel | GitHub Pages is free and integrated with repository |
| GitHub Actions | Travis CI, CircleCI | GitHub Actions is native to GitHub |

**Installation:**
```bash
# Already installed: pkgdown 2.1.2
# GitHub Actions workflow already configured
```

## Architecture Patterns

### Recommended Project Structure
```
.github/workflows/
├── pkgdown.yaml           # Automatic build and deployment
inst/
├── _pkgdown.yml           # Website configuration
docs/                      # Built website (do not edit manually)
├── index.html
├── reference/
├── articles/
└── pkgdown.yml           # Build metadata
```

### Pattern 1: pkgdown Configuration
**What:** YAML configuration file controlling website appearance and structure
**When to use:** All pkgdown websites
**Example:**
```yaml
# inst/_pkgdown.yml
url: https://bfunovits.github.io/RLDM/
template:
  bootstrap: 5
  includes:
    in_header: |
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
navbar:
  structure:
    left:
    - intro
    - reference
    - articles
    right:
    - search
    - github
```

### Pattern 2: GitHub Actions Deployment
**What:** Automated build and deployment workflow
**When to use:** All pkgdown websites on GitHub
**Example:**
```yaml
# .github/workflows/pkgdown.yaml
name: pkgdown
on:
  push:
    branches: [main, master]
jobs:
  pkgdown:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
      - uses: r-lib/actions/setup-r-dependencies@v2
        with:
          extra-packages: any::pkgdown
      - name: Build site
        run: pkgdown::build_site_github_pages(new_process = FALSE, install = FALSE)
      - name: Deploy to GitHub pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: docs
```

### Anti-Patterns to Avoid
- **Editing docs/ manually:** The docs/ directory is generated by pkgdown - edit source documentation instead
- **Including internal functions:** Only include exported functions with Rd documentation in reference sections
- **Manual deployment:** Use GitHub Actions for automatic deployment

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Website deployment | Custom scripts | GitHub Actions workflow | Handles dependencies, caching, deployment |
| Math rendering | Custom JS | MathJax integration in pkgdown | Standard, well-tested, accessible |
| Search functionality | Custom search | pkgdown built-in search | Integrated with documentation structure |
| Mobile responsiveness | Custom CSS | Bootstrap 5 template | Standard, tested across devices |

**Key insight:** pkgdown provides comprehensive website generation tailored for R packages. Custom solutions miss R-specific features like function linking and example rendering.

## Common Pitfalls

### Pitfall 1: Missing Topic References
**What goes wrong:** Build fails with "must be a known topic name or alias" error
**Why it happens:** pkgdown configuration references functions without Rd documentation
**How to avoid:** Only include exported functions with `@export` tag and Rd files
**Warning signs:** References to internal/C++ functions in `_pkgdown.yml`

### Pitfall 2: Outdated Bootstrap Version
**What goes wrong:** Website looks outdated or has compatibility issues
**Why it happens:** Using old Bootstrap 3 instead of Bootstrap 5
**How to avoid:** Explicitly set `template.bootstrap: 5` in configuration
**Warning signs:** No `template.bootstrap` setting or value is 3

### Pitfall 3: Broken GitHub Actions
**What goes wrong:** Website doesn't update on push
**Why it happens:** Missing permissions, wrong branch, or dependency issues
**How to avoid:** Use standard r-lib/actions setup and check workflow permissions
**Warning signs:** GitHub Actions workflow failures

### Pitfall 4: Local vs Remote Build Differences
**What goes wrong:** Website works locally but fails on GitHub Actions
**Why it happens:** Different R versions, package versions, or system dependencies
**How to avoid:** Test with `new_process = FALSE` and match GitHub Actions environment
**Warning signs:** Successful local build but failed CI build

## Code Examples

Verified patterns from existing configuration:

### Current pkgdown Configuration (with issue)
```yaml
# inst/_pkgdown.yml (excerpt with issue)
reference:
- title: RcppArmadillo Implementations - Solving
  contents:
  - outputs_ARMA_cpp   # MISSING: No Rd documentation
  - outputs_STSP_cpp   # MISSING: No Rd documentation
  - residuals_ARMA_cpp # MISSING: No Rd documentation
  # ... other internal C++ functions
```

### Fixed pkgdown Configuration
```yaml
# Should remove or replace with actual documented functions
# These are internal C++ functions without public documentation
```

### Local Build Command
```r
# Build site locally for testing
pkgdown::build_site(preview = FALSE)

# Or with specific options
pkgdown::build_site(
  preview = FALSE,
  new_process = FALSE,  # Match GitHub Actions
  install = FALSE       # Match GitHub Actions
)
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Manual website | pkgdown automatic generation | ~2017 | Documentation stays in sync with code |
| Bootstrap 3 | Bootstrap 5 | pkgdown 2.0.0 | Modern design, better accessibility |
| Manual deployment | GitHub Actions automation | ~2019 | Automatic updates on push |
| Separate math rendering | Built-in MathJax | pkgdown 1.0.0 | Consistent mathematical notation |

**Deprecated/outdated:**
- `template.bootstrap: 3` - Use `template.bootstrap: 5`
- Manual `docs/` directory management - Let pkgdown generate it
- Travis CI for pkgdown - Use GitHub Actions

## Open Questions

Things that couldn't be fully resolved:

1. **Redirect from GitHub Pages to custom domain**
   - What we know: https://bfunovits.github.io/RLDM/ redirects to https://berndfunovits.com/RLDM/
   - What's unclear: How this redirect is configured (CNAME file or DNS)
   - Recommendation: Check for `docs/CNAME` file or repository settings

2. **Internal C++ function documentation strategy**
   - What we know: 8 C++ functions referenced in pkgdown config lack Rd files
   - What's unclear: Whether these should be documented or removed from config
   - Recommendation: Remove from public reference since they're internal

3. **Package-level documentation display**
   - What we know: Phase 4 added package-level documentation (`?RLDM`)
   - What's unclear: How this appears on the website
   - Recommendation: Verify package documentation appears in reference section

## Sources

### Primary (HIGH confidence)
- Existing RLDM pkgdown configuration (`inst/_pkgdown.yml`)
- Existing GitHub Actions workflow (`.github/workflows/pkgdown.yaml`)
- pkgdown documentation (https://pkgdown.r-lib.org/) - Configuration and build options
- Current website at https://berndfunovits.com/RLDM/

### Secondary (MEDIUM confidence)
- r-lib/actions examples - Standard pkgdown workflow patterns
- pkgdown GitHub repository - Current version and issues

### Tertiary (LOW confidence)
- WebSearch attempted but encountered API errors

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Based on existing working infrastructure
- Architecture: HIGH - Based on established pkgdown patterns
- Pitfalls: HIGH - Based on actual build failure analysis

**Research date:** 2026-01-30
**Valid until:** 2026-02-13 (14 days for web deployment practices)
