<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a function similar to ll_theta() but faster and more memory efficient.
The model structure (template) and the data (y) are encoded within the
generated closure (a function plus its enclosing environment).
The generated function calls compiled C/C++ code (see RcppArmadillo-package) and
hence is much faster than calling ll_theta(th, template, y, ...)."><title>Log Likelihood Function Factory — ll_FUN • RLDM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Log Likelihood Function Factory — ll_FUN"><meta property="og:description" content="Creates a function similar to ll_theta() but faster and more memory efficient.
The model structure (template) and the data (y) are encoded within the
generated closure (a function plus its enclosing environment).
The generated function calls compiled C/C++ code (see RcppArmadillo-package) and
hence is much faster than calling ll_theta(th, template, y, ...)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RLDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_RLDM.html">Rational Linear Dynamic Models (RLDM)</a>
    <a class="dropdown-item" href="../articles/b_RLDM_technicaldetails.html">Rational Linear Dynamic Models (RLDM): Technical Details</a>
    <a class="dropdown-item" href="../articles/c_hrk_stage3.html">Hannan-Rissanen-Kavalieris Estimation - Stage 3</a>
    <a class="dropdown-item" href="../articles/d_casestudy2.html">Case Study</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bfunovits/RLDM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Log Likelihood Function Factory</h1>
      
      <div class="d-none name"><code>ll_FUN.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a function similar to <code><a href="ll_theta.html">ll_theta()</a></code> but faster and more memory efficient.
The model structure (<code>template</code>) and the data (<code>y</code>) are encoded within the
generated closure (a function plus its enclosing environment).
The generated function calls compiled C/C++ code (see <a href="https://rdrr.io/pkg/RcppArmadillo/man/RcppArmadillo-package.html" class="external-link">RcppArmadillo-package</a>) and
hence is much faster than calling <code>ll_theta(th, template, y, ...)</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ll_FUN</span><span class="op">(</span></span>
<span>  <span class="va">template</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"concentrated"</span>, <span class="st">"conditional"</span>, <span class="st">"kf"</span>, <span class="st">"gr_concentrated"</span><span class="op">)</span>,</span>
<span>  skip <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-08</span>,</span>
<span>  err <span class="op">=</span> <span class="cn">NA_real_</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>template</dt>
<dd><p>A model template, see <a href="model_structures.html">model structures</a>.</p></dd>


<dt>y</dt>
<dd><p>sample, i.e. an \((N,m)\) dimensional matrix, or a "time series"
object (i.e. <code>as.matrix(y)</code> should return an \((N,m)\)-dimensional
numeric matrix). Missing values (<code>NA</code>, <code>NaN</code> and <code>Inf</code>) are
<strong>not</strong> supported.</p></dd>


<dt>which</dt>
<dd><p>(string) Determines the type of ll function.</p></dd>


<dt>skip</dt>
<dd><p>(integer) skip initial observations. If <code>NULL</code> then
<code>skip</code> is set to \(0\) for state space models and to
\(\max(p,q)\) for ARMA models. This parameter
is only used for the cases "concentrated", "conditional" and "gr_concentrated"</p></dd>


<dt>tol</dt>
<dd><p>(double) tolerance used by <code><a href="ll_kf.html">ll_kf_cpp()</a></code>.</p></dd>


<dt>err</dt>
<dd><p>(double) return value for the case "kf", if the computation
of the initial state covariance fails.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A function, <code>llfun(th)</code> say, which computes the log-likelihood for given
<em>deep</em> parameters <code>th</code>. This function may be used for ML estimation of the model.</p>


<p>Function <code>fn(th)</code></p>


    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Generate a random model in echelon form model (m = 3)</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu"><a href="model_structures.html">tmpl_stsp_echelon</a></span><span class="op">(</span>nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="r_model.html">r_model</a></span><span class="op">(</span>template <span class="op">=</span> <span class="va">tmpl</span>, bpoles <span class="op">=</span> <span class="fl">1</span>, bzeroes <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># scale the diagonal entries of sigma_L</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> state space model [3,3] with s = 4 states</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            s[1]       s[2]        s[3]        s[4]         u[1]        u[2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1]  0.0000000  0.0000000  0.00000000  1.00000000 -0.316544336 -0.01618156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2] -0.1343018  0.0788082 -0.16292945  0.04851508  0.144851363 -0.05508861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3]  0.1347323 -0.5678526 -0.06054697 -0.33873440  0.340936411 -0.13968850</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4] -0.1475590  0.2271577  0.10033103  0.34843878  0.003707541 -0.02091956</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1]  1.0000000  0.0000000  0.00000000  0.00000000  1.000000000  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2]  0.0000000  1.0000000  0.00000000  0.00000000  0.000000000  1.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  0.0000000  0.0000000  1.00000000  0.00000000  0.000000000  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1]  0.33103076</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2] -0.20389659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3] -0.01847925</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4] -0.17822994</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1]  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2]  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  1.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Left square root of noise covariance Sigma:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              u[1]      u[2] u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[1]  1.000000000 0.0000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[2]  0.319242474 1.0000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[3] -0.006575605 0.2957114    1</span>
<span class="r-in"><span><span class="co"># extract the corresponding free/deep parameters</span></span></span>
<span class="r-in"><span><span class="va">th</span> <span class="op">=</span> <span class="fu"><a href="fill_template.html">extract_theta</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">tmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate a sample with 50 observations</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">model</span>, n.obs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># conditional log likelihood</span></span></span>
<span class="r-in"><span><span class="co"># the following statements return the same ll value!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ll.html">ll</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">y</span>, <span class="st">'conditional'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.834035</span>
<span class="r-in"><span><span class="fu"><a href="ll_theta.html">ll_theta</a></span><span class="op">(</span><span class="va">th</span>, <span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'conditional'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.834035</span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">=</span> <span class="fu">ll_FUN</span><span class="op">(</span><span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'conditional'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fn</span><span class="op">(</span><span class="va">th</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.834035</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># concentrated conditional log likelihood</span></span></span>
<span class="r-in"><span><span class="co"># the following statements return the same ll value!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ll.html">ll</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">y</span>, <span class="st">'concentrated'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.692632</span>
<span class="r-in"><span><span class="fu"><a href="ll_theta.html">ll_theta</a></span><span class="op">(</span><span class="va">th</span>, <span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'concentrated'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.692632</span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">=</span> <span class="fu">ll_FUN</span><span class="op">(</span><span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'concentrated'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fn</span><span class="op">(</span><span class="va">th</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.692632</span>
<span class="r-in"><span><span class="co"># for this case, we may also compute the (analytic) gradient</span></span></span>
<span class="r-in"><span><span class="va">gr</span> <span class="op">=</span> <span class="fu">ll_FUN</span><span class="op">(</span><span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'gr_concentrated'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gr</span><span class="op">(</span><span class="va">th</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  0.041822199  0.055770379  0.052686267  0.057284023 -0.010455921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] -0.077393993 -0.042746729  0.020181147  0.002563469  0.074772863</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] -0.013562400 -0.093805050  0.407322752  0.128816294  0.029782568</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16]  0.152448556  0.179700493  0.249915026  0.088241938  0.348236125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21]  0.023887748 -0.202170018  0.204631962 -0.144663738  0.000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26]  0.000000000  0.000000000  0.000000000  0.000000000  0.000000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># log likelihood (via Kalman filter)</span></span></span>
<span class="r-in"><span><span class="co"># the following statements return the same ll value!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ll.html">ll</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">y</span>, <span class="st">'kf2'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.839648</span>
<span class="r-in"><span><span class="fu"><a href="ll_theta.html">ll_theta</a></span><span class="op">(</span><span class="va">th</span>, <span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'kf2'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.839648</span>
<span class="r-in"><span><span class="fu"><a href="ll.html">ll</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">y</span>, <span class="st">'kf'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.839648</span>
<span class="r-in"><span><span class="fu"><a href="ll_theta.html">ll_theta</a></span><span class="op">(</span><span class="va">th</span>, <span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'kf'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.839648</span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">=</span> <span class="fu">ll_FUN</span><span class="op">(</span><span class="va">tmpl</span>, <span class="va">y</span>, <span class="st">'kf'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fn</span><span class="op">(</span><span class="va">th</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.839648</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://scholar.google.com/citations?user=-Ytb9BYAAAAJ" class="external-link">Wolfgang Scherrer</a>, <a href="https://ch.linkedin.com/in/bernd-funovits-phd-cfa-a8215016" class="external-link">Bernd Funovits</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

