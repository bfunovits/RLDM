<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Autoregressive Models — est_ar • RLDM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Autoregressive Models — est_ar"><meta name="description" content='The function est_ar estimates (V)AR models
$$(y_t - \mu) = a_1 (y_{t-1} - \mu) + \cdots + a_p (y_{t-p} - \mu) + u_t$$
from a given sample or a given (sample) autocovariance function.
The model order \(p\) is chosen by an information criterion, like AIC or BIC.
The "helper" functions est_ar_ols, est_ar_yw and est_ar_dlw implement
the three available estimation methods: estimation by ordinary least squares, the Yule-Walker
estimates and the Durbin-Levinson-Whittle method.'><meta property="og:description" content='The function est_ar estimates (V)AR models
$$(y_t - \mu) = a_1 (y_{t-1} - \mu) + \cdots + a_p (y_{t-p} - \mu) + u_t$$
from a given sample or a given (sample) autocovariance function.
The model order \(p\) is chosen by an information criterion, like AIC or BIC.
The "helper" functions est_ar_ols, est_ar_yw and est_ar_dlw implement
the three available estimation methods: estimation by ordinary least squares, the Yule-Walker
estimates and the Durbin-Levinson-Whittle method.'><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RLDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/0_getting_started.html">Getting Started with RLDM</a></li>
    <li><a class="dropdown-item" href="../articles/1_case_study.html">Case Study: Economic Data Analysis with RLDM</a></li>
    <li><a class="dropdown-item" href="../articles/2_technical_reference.html">Technical Reference: RLDM Classes and Methods</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bfunovits/RLDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Autoregressive Models</h1>

      <div class="d-none name"><code>est_ar.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>est_ar</code> estimates (V)AR models
$$(y_t - \mu) = a_1 (y_{t-1} - \mu) + \cdots + a_p (y_{t-p} - \mu) + u_t$$
from a given sample or a given (sample) autocovariance function.
The model order \(p\) is chosen by an information criterion, like <em>AIC</em> or <em>BIC</em>.
The "helper" functions <code>est_ar_ols</code>, <code>est_ar_yw</code> and <code>est_ar_dlw</code> implement
the three available estimation methods: estimation by ordinary least squares, the Yule-Walker
estimates and the Durbin-Levinson-Whittle method.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est_ar</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  p.max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AIC"</span>, <span class="st">"BIC"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yule-walker"</span>, <span class="st">"ols"</span>, <span class="st">"durbin-levinson-whittle"</span><span class="op">)</span>,</span>
<span>  mean_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample.mean"</span>, <span class="st">"intercept"</span>, <span class="st">"zero"</span><span class="op">)</span>,</span>
<span>  n.obs <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">est_ar_yw</span><span class="op">(</span><span class="va">gamma</span>, p.max <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, penalty <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">est_ar_dlw</span><span class="op">(</span><span class="va">gamma</span>, p.max <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, penalty <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">est_ar_ols</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  p.max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  mean_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample.mean"</span>, <span class="st">"intercept"</span>, <span class="st">"zero"</span><span class="op">)</span>,</span>
<span>  p.min <span class="op">=</span> <span class="fl">0L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p>either a "time series" object (i.e <code>as.matrix(obj)</code>
returns an \((N,m)\)-dimensional numeric matrix)
or an <code><a href="autocov.html">autocov()</a></code> object which represents an (estimated) autocovariance function.
The type of the <code>autocov</code> object is irrelevant since <code>est_ar</code> always uses the
slot <code>obj$gamma</code> which contains the autocovariance function.</p></dd>


<dt id="arg-p-max">p.max<a class="anchor" aria-label="anchor" href="#arg-p-max"></a></dt>
<dd><p>(integer or <code>NULL</code>) Maximum order of the candidate AR models.
For the default choice see below.</p></dd>


<dt id="arg-penalty">penalty<a class="anchor" aria-label="anchor" href="#arg-penalty"></a></dt>
<dd><p>is a scalar (or NULL) which determines the "penalty" per parameter of the model.
Note that this parameter (if not <code>NULL</code>) overrides the paramater <code>ic</code>.</p></dd>


<dt id="arg-ic">ic<a class="anchor" aria-label="anchor" href="#arg-ic"></a></dt>
<dd><p>(character string) Which information criterion shall be used to find the optimal order.
Note that <code>ic="max"</code> means that an AR(p) model with <code>p=p.max</code> is estimated.
Default is <code>ic="AIC"</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string giving the method used to fit the model.
Note that 'yule-walker' and 'durbin-levinson-whittle' are (up to numerical errors) equivalent
and that the choice 'ols' is only available for a "time-series" object <code>obj</code>.</p></dd>


<dt id="arg-mean-estimate">mean_estimate<a class="anchor" aria-label="anchor" href="#arg-mean-estimate"></a></dt>
<dd><p>Character string giving the method used to estimate the mean \(\mu\).
Default is <code>mean_estimate = "sample.mean"</code>.
See the details below.</p></dd>


<dt id="arg-n-obs">n.obs<a class="anchor" aria-label="anchor" href="#arg-n-obs"></a></dt>
<dd><p>Optional integer which gives the sample size \(N\).
This parameter is only used, when <code>obj</code> is an <code>autocov</code> object.
If <code>n.obs=NULL</code> then the slot <code>obj$n.obs</code> is used.
Note that <code>obj$n.obs=NULL</code> or <code>obj$n.obs=Inf</code> refers to the case of a population
autocovariance function, i.e. \(N=\infty\).
<br>
For a "time series" object the sample size is of course set to the number of observations,
i.e. <code>n.obs = nrow(as.matrix(obj))</code>.
<br>
The sample size \(N\) controls the computation of the default maximum order <code>p.max</code> and
the computation of the information criterion.</p></dd>


<dt id="arg-gamma">gamma<a class="anchor" aria-label="anchor" href="#arg-gamma"></a></dt>
<dd><p>\((m,m,lag.max+1)\)-dimensional array, which contains the (sample) autocovariance function.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>\((N,m)\)-dimensional matrix, which contains the sample.</p></dd>


<dt id="arg-p-min">p.min<a class="anchor" aria-label="anchor" href="#arg-p-min"></a></dt>
<dd><p>(non negative integer) Minimum order of the candidate AR models.
Only used by <code>est_ar_ols</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function <code>est_ar</code> returns a list with components</p>
<dl><dt>model</dt>
<dd><p><code><a href="armamod.html">armamod()</a></code> object which represents the estimated AR model.</p></dd>

<dt>p</dt>
<dd><p>optimal model order.</p></dd>

<dt>stats</dt>
<dd><p>(p.max+1,4) dimensional matrix which stores the \(\ln\det(\Sigma_p)\)
values, the number of parameters and the IC values. See the details below.</p></dd>

<dt>y.mean</dt>
<dd><p>estimate of the mean \(\mu\).</p></dd>

<dt>ll</dt>
<dd><p>The log likelihood of the estimated model.</p></dd>

</dl><p>The "helper" functions <code>est_ar_yw</code>, <code>est_ar_dlw</code> and <code>est_ar_ols</code> return a list with components</p>
<dl><dt>a</dt>
<dd><p><code>(m,m,p)</code>-dimensional array with the estimated AR coefficients \(a_i\).</p></dd>

<dt>sigma</dt>
<dd><p><code>(m,m)</code>-dimensional matrix with the estimated noise covariance \(\Sigma\).</p></dd>

<dt>p</dt>
<dd><p>estimate of the AR order.</p></dd>

<dt>stats</dt>
<dd><p>(p.max+1,4) dimensional matrix which stores the \(\ln\det(\Sigma_p)\)
values, the number of parameters and the IC values. See the details below.</p></dd>

<dt>y.mean</dt>
<dd><p>(<code>est_ar_ols</code> only) estimate of the mean \(\mu\).</p></dd>

<dt>residuals</dt>
<dd><p>(<code>est_ar_ols</code> only) <code>(n.obs,m)</code> dimensional matrix with the OLS residuals.</p></dd>

<dt>partial</dt>
<dd><p>(<code>est_ar_dlw</code> only) <code>(m,m,p.max+1)</code> dimensional array with
the (estimated) partial autocorrelation coefficients.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="ols-method">OLS method<a class="anchor" aria-label="anchor" href="#ols-method"></a></h2>



<p>The helper function <code>est_ar_ols</code> implements three schemes to estimate the mean \(\mu\)
and the AR parameters. The choice <code>mean_estimate = "zero"</code> assumes \(\mu=0\) and thus
the AR parameters are determined from the regression:
$$y_t = a_1 y_{t-1} + \cdots + a_p y_{t-p} + u_t \mbox{ for } t=p+1,\ldots,N$$
In the case <code>mean_estimate = "sample.mean"</code> the mean \(\mu\) is estimated by the sample
mean and the AR parameters are determined by the LS estimate of the regression
$$(y_t - \mu) = a_1 (y_{t-1} - \mu) + \cdots + a_p (y_{t-p} - \mu) + u_t \mbox{ for } t=p+1,\ldots,N$$
In the last case <code>mean_estimate = "intercept"</code>, a regression with intercept
$$y_t = d + a_1 y_{t-1} + \cdots + a_p y_{t-p} + u_t \mbox{ for } t=p+1,\ldots,N$$
is considered. The estimate for \(\mu\) then is obtained as
$$\mu = (I_m - a_1 - \cdots - a_p)^{-1} d$$
This estimate of the mean \(\mu\) fails if the estimated AR model has a <em>unit root</em>, i.e. if
\((I_m - a_1 - \cdots - a_p)\) is singular.</p>
<p>The sample covariance of the corresponding residuals (scaled with \(1/(N-p)\)) serves as
an estimate for the noise covariance \(\Sigma\).</p>
<p>For the actual computations the routine <code><a href="https://rdrr.io/r/stats/lsfit.html" class="external-link">stats::lsfit()</a></code> in the <span class="pkg">stats</span> package is used.</p>
    </div>
    <div class="section level2">
    <h2 id="yule-walker-estimates">Yule-Walker estimates<a class="anchor" aria-label="anchor" href="#yule-walker-estimates"></a></h2>



<p>Both  <code>est_ar_yw</code> and <code>est_ar_dlw</code> use the <em>Yule-Walker</em> equations to estimate
the AR coefficients \((a_i)\) and the noise covariance matrix \(\Sigma\).
However, they use a different numerical scheme to solve these equations.
The function <code>est_ar_dlw</code> uses the <em>Durbin-Levinson-Whittle</em> recursions and
in addition returns (estimates of) the partial autocorrelation coefficients.</p>
<p>If <code>obj</code> is a "time series" object, then first the ACF is estimated with a call to
<code><a href="autocov.html">autocov()</a></code>. The option <code>mean_estimate = "zero"</code> implies that the mean is assumed to
be zero (\(\mu = 0\)) and therefore <code>autocov</code> is called with the option <code>demean = FALSE</code>.</p>
<p>For <code>mean_estimate = "sample.mean"</code> or <code>mean_estimate = "intercept"</code> the mean \(\mu\)
is estimated by the sample mean and the ACF is computed with  <code>demean = TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="estimation-of-the-ar-order">Estimation of the AR order<a class="anchor" aria-label="anchor" href="#estimation-of-the-ar-order"></a></h2>



<p>The order \(p\) of the AR model is chosen by minimizing an information criterion of the form
$$IC(p) = \ln\det\Sigma_p + c(p)r(N) \mbox{ for } p = 0,\ldots,p_{\max}$$
where \(\Sigma_p\) is the estimate of the noise (innovation) covariance,
\(c(p)\) counts the number of parameters of the model,
and \(r(N)\) is the "penalty" per parameter of the model.
Note that \(\log\det\Sigma\) is up to a constant
and a scaling factor \(-(N-p)/2\)
equal to the (scaled, approximate) Gaussian log likelihood of the model
$$ll = -(1/2)(m \ln(2\pi) + m + \ln\det \Sigma_p)$$
See also <code><a href="ll.html">ll()</a></code>. Note that the value \(ll\), which is returned by
this routine, is the (approximate) log Likelihood <strong>scaled</strong> by a factor \(1/(N-p)\).</p>
<p>For an AR(p) model with intercept, the number of parameters is
\(c(p) = p m^2 + m\) and for the AR model without intercept
\(c(p) = p m^2\).</p>
<p>The Akaike information criterion (AIC) corresponds to \(r(N)=2/N\) and the
Bayes information criterion (BIC) uses the penatlty \(r(N)=\log(N)/N\).</p>
<p>For the helper routines, the user has to set the penalty term \(r(N)\) explicitly via the
input parameter "<code>penalty</code>". The default choice <code>penalty = -1</code> means that the maximum
possible order <code>p=p.max</code> is chosen.</p>
<p>The function <code>est_ar</code> offers the parameter "<code>ic</code>" which tells the routine to set the
penalty accordingly. Note that the choice <code>ic="max"</code> sets \(r(N) = -1\) and thus again
the model with maximum possible order is fitted.</p>
<p>The default maximum order <code>p.max</code> is chosen as follows.
The helper functions <code>est_ar_yw</code> and <code>est_ar_dlw</code> simply chose the maximum
accordng to maximum lag of the given autocovariances, <code>p.max = dim(gamma)[3] - 1</code>.
The routine <code>est_ar_ols</code> uses the minimum of \(12\), \((N-1)/(m+1)\) and \(10*log10(N)\)
as default. The function <code>est_ar</code> uses the same value.
However, if "<code>obj</code>" is an <code>autocov</code> object then <code>p.max</code> is in addition bounded
by the number of lags contained in this object.</p>
    </div>
    <div class="section level2">
    <h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a></h2>



<p>The Yule-Walker estimates offer an easy way to reconstruct the "true" model if the population
autocovariance function is given. The noise covariance (and thus the likelihood values) should
not improve when a model with an order larger than the true model order is "estimated".
However due to numerical errors this may not be true. As a simple trick one may call <code>est_ar</code>
(<code>est_ar_yw</code> or <code>est_ar_dlw</code>) with a very small positive <code>penalty</code>. See the example below.</p>
<p>The functions are essentially equivalent to the <span class="pkg">stats</span> routines.
They are (re) implemented for convenience, such that the input and output parameters (models) fit
to the <span class="pkg">RLDM</span> conventions.</p>
<p>The AIC values of <span class="pkg">RLDM</span> routines are equivalent to the AIC values computed
by the <span class="pkg">stats</span> routines up to a constant and up to scaling by \(N\).</p>
<p>It seems that the Yule-Walker estimate <code>stats::[ar.yw][stats::ar.yw]</code> uses a scaling
factor \((N - m(p+1))/N\) for the noise covariance \(\Sigma\).</p>
<p>Finally note that <code>est_ar_ols</code>, <code>est_ar_yw</code> and <code>est_ar_dlw</code> are mainly
intended as "internal helper" functions.
Therefore, these functions do not check the validity of the input parameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># set seed, to get reproducable results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5436</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################################################</span></span></span>
<span class="r-in"><span><span class="co"># generate a (bivariate) random, stable AR(3) model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">n.obs</span> <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">p.max</span> <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu"><a href="model_structures.html">tmpl_arma_pq</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span>, n <span class="op">=</span> <span class="va">m</span>, p <span class="op">=</span> <span class="va">p</span>, q <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="r_model.html">r_model</a></span><span class="op">(</span><span class="va">tmpl</span>, bpoles <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># make sure that the diagonal entries of sigma_L are non negative</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################################################</span></span></span>
<span class="r-in"><span><span class="co"># reconstruct the true AR model from the population ACF</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">true_acf</span> <span class="op">=</span> <span class="fu"><a href="autocov.html">autocov</a></span><span class="op">(</span><span class="va">model</span>, lag.max <span class="op">=</span> <span class="fl">12</span>, type <span class="op">=</span> <span class="st">'covariance'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ARest</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">true_acf</span>, p.max <span class="op">=</span> <span class="va">p.max</span>, method <span class="op">=</span> <span class="st">'yule-walker'</span>, penalty <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">ARest</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################################################</span></span></span>
<span class="r-in"><span><span class="co"># simulate a sample</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">model</span>, n.obs <span class="op">=</span> <span class="va">n.obs</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>s1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################################################</span></span></span>
<span class="r-in"><span><span class="co"># estimate the AR(p) model with the true order p</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OLS</span></span></span>
<span class="r-in"><span><span class="va">ARest</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">y</span>, ic <span class="op">=</span> <span class="st">'max'</span>, p.max <span class="op">=</span> <span class="va">p</span>, method <span class="op">=</span> <span class="st">'ols'</span>, mean_estimate <span class="op">=</span> <span class="st">"zero"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># check the log Likelihood</span></span></span>
<span class="r-in"><span><span class="va">p.opt</span> <span class="op">=</span> <span class="va">ARest</span><span class="op">$</span><span class="va">p</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="ll.html">ll</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">model</span>, <span class="va">y</span>, <span class="st">'conditional'</span>, skip <span class="op">=</span> <span class="va">p.opt</span><span class="op">)</span>, <span class="va">ARest</span><span class="op">$</span><span class="va">ll</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Yule-Walker and Durbin-Levinson-Whittle are equivalent (up to numerical errors)</span></span></span>
<span class="r-in"><span><span class="va">ARest</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">y</span>, ic <span class="op">=</span> <span class="st">'max'</span>, p.max <span class="op">=</span> <span class="va">p</span>, method <span class="op">=</span> <span class="st">'yule-walker'</span>, mean_estimate <span class="op">=</span> <span class="st">"zero"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">junk</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">y</span>, ic <span class="op">=</span> <span class="st">'max'</span>, p.max <span class="op">=</span> <span class="va">p</span>, method <span class="op">=</span> <span class="st">'durbin-levinson-whittle'</span>, mean_estimate <span class="op">=</span> <span class="st">"zero"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">model</span>, <span class="va">junk</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># alternatively we may first estimate the sample autocovariance function</span></span></span>
<span class="r-in"><span><span class="co"># note that the 'type' of the ACF is irrelevant</span></span></span>
<span class="r-in"><span><span class="va">sample_acf</span> <span class="op">=</span> <span class="fu"><a href="autocov.html">autocov</a></span><span class="op">(</span><span class="va">y</span>, type <span class="op">=</span> <span class="st">'correlation'</span>, demean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">junk</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">sample_acf</span>, ic <span class="op">=</span> <span class="st">'max'</span>, p.max <span class="op">=</span> <span class="va">p</span>, method <span class="op">=</span> <span class="st">'yule-walker'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">model</span>, <span class="va">junk</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################################################</span></span></span>
<span class="r-in"><span><span class="co"># estimate the order of the AR model with 'AIC', estimate a model with intercept</span></span></span>
<span class="r-in"><span><span class="va">ARest</span> <span class="op">=</span> <span class="fu">est_ar</span><span class="op">(</span><span class="va">y</span>, ic <span class="op">=</span> <span class="st">'AIC'</span>, p.max <span class="op">=</span> <span class="va">p.max</span>, method <span class="op">=</span> <span class="st">'ols'</span>, mean_estimate <span class="op">=</span> <span class="st">"intercept"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ARMA model [2,2] with orders p = 3 and q = 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AR polynomial a(z):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      z^0 [,1]  [,2]  z^1 [,1]       [,2]  z^2 [,1]       [,2]  z^3 [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]        1     0 0.1758752 -0.2469383 0.4064368 -0.2595963 0.7758289</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]        0     1 0.3113271 -0.3092643 0.3315128 -0.1661434 0.3077410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.2624946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.2492206</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MA polynomial b(z):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      z^0 [,1]  [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]        1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]        0     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Left square root of noise covariance Sigma:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          u[1]      u[2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[1] 0.144723 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[2] 0.188681 0.1501011</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare with the stats::ar function</span></span></span>
<span class="r-in"><span><span class="va">ARest2</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/ar.html" class="external-link">ar</a></span><span class="op">(</span><span class="va">y</span>, aic <span class="op">=</span> <span class="cn">TRUE</span>, order.max <span class="op">=</span> <span class="va">p.max</span>, method <span class="op">=</span> <span class="st">'ols'</span>, intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># the estimated coefficients are equal</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">[</span>,,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="va">ARest2</span><span class="op">$</span><span class="va">ar</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># also the AIC values are up to scaling equivalent</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">ARest</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span>,<span class="st">'ic'</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ARest</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span>,<span class="st">'ic'</span><span class="op">]</span><span class="op">)</span>, <span class="va">ARest2</span><span class="op">$</span><span class="va">aic</span><span class="op">/</span><span class="va">n.obs</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># reset seed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://scholar.google.com/citations?user=-Ytb9BYAAAAJ" class="external-link">Wolfgang Scherrer</a>, <a href="https://ch.linkedin.com/in/bernd-funovits-phd-cfa-a8215016" class="external-link">Bernd Funovits</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

