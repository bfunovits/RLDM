<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='These functions implement the "standard" Kalman filter and the "square root" Kalman filter (also called "square root covariance filter") for time invariant, linear state space systems without exogenous inputs, see e.g. (Anderson and Moore 2005)
.'><title>Kalman Filter — kf • RLDM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Kalman Filter — kf"><meta property="og:description" content='These functions implement the "standard" Kalman filter and the "square root" Kalman filter (also called "square root covariance filter") for time invariant, linear state space systems without exogenous inputs, see e.g. (Anderson and Moore 2005)
.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RLDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_RLDM.html">Rational Linear Dynamic Models (RLDM)</a>
    <a class="dropdown-item" href="../articles/b_RLDM_technicaldetails.html">Rational Linear Dynamic Models (RLDM): Technical Details</a>
    <a class="dropdown-item" href="../articles/c_hrk_stage3.html">Hannan-Rissanen-Kavalieris Estimation - Stage 3</a>
    <a class="dropdown-item" href="../articles/d_casestudy2.html">Case Study</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bfunovits/RLDM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Kalman Filter</h1>
      
      <div class="d-none name"><code>kf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions implement the "standard" Kalman filter and the "square root" Kalman filter (also called "square root covariance filter") for time invariant, linear state space systems without exogenous inputs, see e.g. (Anderson and Moore 2005)
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">kf_cpp</span><span class="op">(</span><span class="va">A</span>, <span class="va">C</span>, <span class="va">Q</span>, <span class="va">R</span>, <span class="va">S</span>, <span class="va">y_t</span>, <span class="va">P1</span>, <span class="va">a1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kf2_cpp</span><span class="op">(</span><span class="va">A</span>, <span class="va">C</span>, <span class="va">H_t</span>, <span class="va">y_t</span>, <span class="va">P1_R</span>, <span class="va">a1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kf</span><span class="op">(</span><span class="va">model</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kf"</span>, <span class="st">"kf2"</span><span class="op">)</span>, P1 <span class="op">=</span> <span class="cn">NULL</span>, a1 <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>A</dt>
<dd><p>\((s,s)\) dimensional state transition matrix \(A\).</p></dd>


<dt>C</dt>
<dd><p>\((m,s)\) dimensional matrix \(C\).</p></dd>


<dt>Q, R, S</dt>
<dd><p>The variance, covariance matrices of the "state disturbances" (\(Bu_t\))
and the "measurement disturbances" (\(Du_t\)) as described above.
These matrices must be of dimension \((s,s)\),  \((m,m)\) and \((s,m)\) respectively.</p></dd>


<dt>y_t</dt>
<dd><p>\((m,N)\) transposed data matrix <code>y_t = t(y)</code>.</p></dd>


<dt>P1</dt>
<dd><p>\((s,s)\) dimensional covariance matrix of the error of the initial state estimate,
i.e. \(\Pi_{1|0}\).
If <code>NULL</code>, then the state covariance \(P = APA'+B\Sigma B'\) is used.
Note that this scheme assumes that the state space model is stable,
i.e. that the state transition matrix \(A\) is stable.</p></dd>


<dt>a1</dt>
<dd><p>\(s\) dimensional vector, which holds the initial estimate \(a_{1|0}\)
for the state at time \(t=1\).  If <code>a1=NULL</code>, then a zero vector is used.</p></dd>


<dt>H_t</dt>
<dd><p>\((n,s+m)\) dimensional matrix. This parameter corresponds to the transpose \(H'\) of
\(H=(D',B')'\Sigma^{1/2}\).</p></dd>


<dt>P1_R</dt>
<dd><p>(right) square root of <code>P1</code>, i.e. <code>P1 = t(P1_R) \%*\% P1_R</code>.</p></dd>


<dt>model</dt>
<dd><p><code><a href="stspmod.html">stspmod()</a></code> object, which represents the state space model.</p></dd>


<dt>y</dt>
<dd><p>sample, i.e. an \((N,m)\) dimensional matrix,
or a "time series" object (i.e. <code>as.matrix(y)</code> should return an
\((N,m)\)-dimensional numeric matrix). Missing values (<code>NA</code>, <code>NaN</code> and
<code>Inf</code>) are <strong>not</strong> supported.</p></dd>


<dt>method</dt>
<dd><p>Character string. If <code>method="kf"</code> then <code>kf</code> calls
<code>kf_cpp</code> ("standard form" of the Kalman filter) and for
<code>method="kf2"</code> the "square root" form of the Kalman filter is used,
i.e. <code>kf2_cpp</code> is called. Up to numerical errors the outputs should not
depend on the chosen method.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>List with components</p>
<dl><dt>e</dt>
<dd><p>\((N,m)\) dimensional matrix with the standardized one-step
ahead prediction errors. The \(t\)-th row of the matrix <code>e</code>
corresponds to
$$e_t = \Sigma_{t|t-1}^{-1/2}\epsilon_{t|t-1}.$$
If the model is correctly specified then these standardized residuals are white noise
with a unit covariance matrix. So they may be used for validaton of the model.</p></dd>

<dt>a</dt>
<dd><p>\((N+1,s)\) dimensional matrix with the estimated states. The
\(t\)-th row of the matrix <code>a</code> corresponds to
\(a_{t|t-1}\). Given <code>y</code> and <code>a</code>, the one step ahead predictions
\(y_{t|t-1}\) may be computed with <code>yh = a \%*\% t(C)</code>.</p></dd>

<dt>ll</dt>
<dd><p>(scaled) Gaussian log likelihood of the model
$$-\frac{1}{2N}\sum_{t=1}^{N}\left(m\log(2\pi) + \log\det\Sigma_{t|t-1} +
          (y_t - y_{t|t-1})' \Sigma_{t|t-1}^{-1} (y_t - y_{t|t-1}) \right).$$</p></dd>

<dt>P1</dt>
<dd><p>\((s,s)\) dimensional covariance matrix of the error of the state prediction
\(a_{N+1|N}\), i.e. this matrix corresponds to \(\Pi_{N+1|N}\).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The model considered is
$$a_{t+1} = A a_t + Bu_t$$
$$y_t = C a_t + Du_t$$
with \(m\)-dimensional outputs \(y_t\), \(s\)-dimensional states
\(a_t\) and \(n\)-dimensional disturbances \(u_t\).
The disturbances are white noise with a covariance matrix
\(\mathbf{E} u_tu_t'=\Sigma\).
Note that the disturbances and the outputs may have <em>different</em> dimensions, however,
only "wide" systems with (\(m\leq n\)) are implemented.</p>
<p>The Kalman filter is a recursive scheme to compute the linear, least squares predictions
for \(a_{t+1}\) and \(y_{t+1}\) given the observations
\(y_t,\ldots,y_1\) up to time \(t\). These predictions are notated with
\(a_{t+1|t}\) and \(y_{t+1|t}\), the
prediction error for the output \(y_{t+1}\) is
\(\epsilon_{t+1|t}=(y_{t+1}-y_{t+1|t})\)
and the corresponding variances of the prediction errors are
$$\Pi_{t+1|t}=\mathbf{E}(a_{t+1}-a_{t+1|t})
(a_{t+1}-a_{t+1|t})',$$
$$\Sigma_{t+1|t}=\mathbf{E}(\epsilon_{t+1|t}
\epsilon_{t+1|t}').$$</p>
<p>The standard form of the Kalman filter is based on the parameter matrices \(A,C\), the variance of
"state disturbances"
\(Q=\mathbf{E}(Bu_t (Bu_t)')=(B\Sigma B')\), the variance
of the "measurement disturbances"
\(R=\mathbf{E}(Du_t (Du_t)')=(D\Sigma D')\) and the covariance
\(S=\mathbf{E}(Bu_t(Du_t)')=(B\Sigma D')\).
Furthermore we need the initial prediction
\(a_{1|0}\) and the corresponding error variance
\(\Pi_{1|0}\).</p>
<p>For the square root form of the filter we need the "square roots"
\(\Pi_{1|0}^{1/2}\) and \(\Sigma^{1/2}\), i.e. matrices such that
\(\Pi_{1|0} = \Pi_{1|0}^{1/2} (\Pi_{1|0}^{1/2})'\)
and \(\Sigma = \Sigma^{1/2}(\Sigma^{1/2})'\). In addition, we define
\(H=(D',B')'\Sigma^{1/2}\).</p>
<p>The routines <code>kf_cpp</code>, <code>kf2_cpp</code> are <span class="pkg">RcppArmadillo</span> implementations of the standard form and
of the square root form of the Kalman filter. The wrapper function <code>kf</code> takes an <code><a href="stspmod.html">stspmod()</a></code> object,
which describes the state space model, and then calls the approriate <code>RcppArmadillo</code> function.</p>
<p>Square root Kalman filter: For the square root
\(\Pi_{1|0}^{1/2}\) the procedure first tries the Cholesky decomposition.
If this fails (since \(\Pi_{1|0}^{1/2}\) is (close to) singular),
then <code>ll_kf</code> tries to compute a symmetric square root via the eigenvalue decomposition
of \(\Pi_{1|0}^{1/2}\).</p>
    </div>
    <div class="section level2">
    <h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a></h2>
    

<p>The <code>RcppArmadillo</code> functions (<code>kf_cpp</code> and <code>kf2_cpp</code>) do not check the input parameters,
so these function must be used with some care.</p>
<p>The procedures only accept "wide" state space systems (\(m \leq n\)), since for
"tall" systems (\(m &gt; n\)) the variance of the prediction errors
(\(\Sigma_{t+1|t}\)) is singular for \(t\) larger than some threshold.</p>
<p>Up to now, there is no support for models with exogenous inputs.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Anderson BDO, Moore JB (2005).
<em>Optimal filtering</em>.
Dover Publications Inc., London.
Originally published: Englewood Cliffs, Prentice-Hall 1979.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>There exist a number of R packages which implement the Kalman filter, e.g.
<span class="pkg">KFAS</span>. However, most of these packages do not allow for correlations between the
"state noise" and the "measurement noise".</p>
<p>If only the likelihood is needed, then one may use <code><a href="ll_kf.html">ll_kf()</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">s</span> <span class="op">=</span> <span class="fl">4</span>  <span class="co"># state dimension</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fl">2</span>  <span class="co"># number of outputs</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">3</span>  <span class="co"># number of inputs,</span></span></span>
<span class="r-in"><span><span class="va">n.obs</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># sample size</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate a (stable) state space model</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu"><a href="model_structures.html">tmpl_stsp_full</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">n</span>, <span class="va">s</span>, sigma_L <span class="op">=</span> <span class="st">"chol"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="r_model.html">r_model</a></span><span class="op">(</span><span class="va">tmpl</span>, bpoles <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># generate a sample</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">model</span>, n.obs <span class="op">=</span> <span class="va">n.obs</span>, a1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute Q, R, S and P1</span></span></span>
<span class="r-in"><span><span class="va">sigma_L</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span></span></span>
<span class="r-in"><span><span class="va">sigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">tcrossprod</a></span><span class="op">(</span><span class="va">sigma_L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">R</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">D</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">D</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">B</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">D</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">B</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P1</span> <span class="op">=</span> <span class="fu">lyapunov</span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">A</span>, <span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># call Kalman filter. Note y_t = t(y)!</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">=</span> <span class="fu">kf_cpp</span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">A</span>, <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">C</span>, <span class="va">Q</span>, <span class="va">R</span>, <span class="va">S</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">P1</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use the wrapper function</span></span></span>
<span class="r-in"><span><span class="va">out_test</span> <span class="op">=</span> <span class="fu">kf</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">'kf'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute H and square root of P1</span></span></span>
<span class="r-in"><span><span class="va">H</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">D</span>, <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sigma_L</span></span></span>
<span class="r-in"><span><span class="va">P1_R</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">P1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># call square root Kalman filter. Note H_t = t(H) and y_t = t(y)!</span></span></span>
<span class="r-in"><span><span class="va">out_test</span> <span class="op">=</span> <span class="fu">kf2_cpp</span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">A</span>, <span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">C</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">P1_R</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># use the wrapper function</span></span></span>
<span class="r-in"><span><span class="va">out_test</span> <span class="op">=</span> <span class="fu">kf</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">'kf2'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The one step ahead predictions for y[t] may be computed by</span></span></span>
<span class="r-in"><span><span class="va">yh</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">a</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">C</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># and the (non scaled) prediction errors are</span></span></span>
<span class="r-in"><span><span class="va">uh</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">out</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n.obs</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span><span class="op">$</span><span class="va">C</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://scholar.google.com/citations?user=-Ytb9BYAAAAJ" class="external-link">Wolfgang Scherrer</a>, <a href="https://ch.linkedin.com/in/bernd-funovits-phd-cfa-a8215016" class="external-link">Bernd Funovits</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

