<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Local Model Structures — local model structures • RLDM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Local Model Structures — local model structures"><meta name="description" content='Parametrization for "local" model classes, in particular, "Data Driven Local Coordinates"
as detailed in (McKelvey et al. 2004)
 and
(Ribarits et al. 2005)
.'><meta property="og:description" content='Parametrization for "local" model classes, in particular, "Data Driven Local Coordinates"
as detailed in (McKelvey et al. 2004)
 and
(Ribarits et al. 2005)
.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RLDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/0_getting_started.html">Getting Started with RLDM</a></li>
    <li><a class="dropdown-item" href="../articles/1_case_study.html">Case Study: Economic Data Analysis with RLDM</a></li>
    <li><a class="dropdown-item" href="../articles/2_technical_reference.html">Technical Reference: RLDM Classes and Methods</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bfunovits/RLDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Local Model Structures</h1>

      <div class="d-none name"><code>local_model_structures.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Parametrization for "local" model classes, in particular, "Data Driven Local Coordinates"
as detailed in (McKelvey et al. 2004)
 and
(Ribarits et al. 2005)
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tmpl_DDLC</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  balance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"lyapunov"</span>, <span class="st">"minimum phase"</span><span class="op">)</span>,</span>
<span>  sigma_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chol"</span>, <span class="st">"symm"</span>, <span class="st">"identity"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tmpl_GRAM</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  balance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lyapunov"</span>, <span class="st">"minimum phase"</span><span class="op">)</span>,</span>
<span>  sigma_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chol"</span>, <span class="st">"symm"</span>, <span class="st">"identity"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p><code><a href="stspmod.html">stspmod()</a></code> object, which represents a state space model. Only the case
\(m = n &gt; 0\) is implemented, i.e. the output process and the noise process must
be of the same dimension.</p></dd>


<dt id="arg-balance">balance<a class="anchor" aria-label="anchor" href="#arg-balance"></a></dt>
<dd><p>(character string) For <code>balance = "lyapunov"</code> or
<code>balance = "minimum phase"</code> the reference model is first balanced by
the respective scheme.</p></dd>


<dt id="arg-sigma-l">sigma_L<a class="anchor" aria-label="anchor" href="#arg-sigma-l"></a></dt>
<dd><p>(character string) determines the form of the (left) square root
of the noise covariance \(\Sigma\). The choice <code>"chol"</code> gives a
lower triangular matrix, <code>"symm"</code> gives a symmetric matrix and
<code>"identity"</code> corresponds to the (fixed) identity matrix.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Model template, i.e. a list with slots</p>
<dl><dt><code>h</code></dt>
<dd><p>\(((m+s)^2 + m^2)\)-dimensional vector,</p></dd>

<dt><code>H</code></dt>
<dd><p>\(((m+s)^2 + m^2, k)\)-dimensional matrix,</p></dd>

<dt><code>class = "stspmod"</code></dt>
<dd></dd>

<dt><code>order = c(m,m,s)</code></dt>
<dd><p>and</p></dd>

<dt><code>n.par</code></dt>
<dd><p>number of free parameters \(=k\).</p></dd>


</dl><p>See also <code><a href="model_structures.html">model structures()</a></code> for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function <code>tmpl_DDLC</code> and <code>tmpl_GRAM</code> construct model templates which describe
models in a neighborhood of a given reference model.
In a first step the reference state space model is transformed to \(D=I\) and eventually
(depending on the parameter <code>"balance"</code>) balanced.</p>
<p>state space models are described by a quadruple \((A,B,C,D=I)\) of matrices which may be
embedded into an \((s^2+2ms)\)-dimensional euclidean space. Note that the parameter matrices
are not uniqely determined from the ACF or the spectral density of the process, i.e. there
is an inherent non identifiablity problem. For minimal models the "equivalence class"
of models, which represent the same ACF is given by the set of all models which
may be obtained by a state transformation
\((A,B,C,D) \rightarrow (TAT^{-1}, TB, CT^{-1}, D)\).</p>
<p>The <em>DDLC</em> parametrization now considers models, \((A,B,C,D=I)\), which
are contained in the \(2ms\)-dimensional subspace, which is <em>orthogonal</em> to
the \(s^2\)-dimensional tangent space of the set of equivalent models.</p>
<p>The routine <code>tmpl_GRAM</code> considers the \(2ms\)-dimensional subspace, where
models close to the reference models are "approximately" balanced.</p>
<p>Both schemes may fail for "non-generic" models. <code>tmpl_DDLC</code> issues a
warning message and <code>tmpl_GRAM</code> throws an error, in cases where the
\(2ms\)-dimensional subspace is not well defined.</p>
<p>Note that also the parametrization of the left square root <code>L=sigma_L</code> of the
noise covariance is "local", i.e. <code>th = 0</code> corresponds to the (balanced) reference model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>McKelvey T, Helmersson A, Ribarits T (2004).
“Data driven local coordinates for multivariable linear systems and their application to system identification.”
<em>Automatica</em>, <b>40</b>(9), 1629 - 1635.
<a href="https://doi.org/10.1016/j.automatica.2004.04.015" class="external-link">doi:10.1016/j.automatica.2004.04.015</a>
.</p>
<p>Ribarits T, Deistler M, Hanzon B (2005).
“An analysis of separable least squares data driven local coordinates for maximum likelihood estimation of linear systems.”
<em>Automatica</em>, <b>41</b>(3), 531 - 544.
<a href="https://doi.org/10.1016/j.automatica.2004.11.014" class="external-link">doi:10.1016/j.automatica.2004.11.014</a>
.
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>For the computation of Grammians and for balancing of state space models,
see <code>rationalmatrices::balance()</code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># create a random state space model with m outputs and s states</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu"><a href="model_structures.html">tmpl_stsp_full</a></span><span class="op">(</span><span class="va">m</span>, n <span class="op">=</span> <span class="va">m</span>, <span class="va">s</span>, sigma_L <span class="op">=</span> <span class="st">'symm'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="r_model.html">r_model</a></span><span class="op">(</span><span class="va">tmpl</span>, bpoles <span class="op">=</span> <span class="fl">1.1</span>, bzeroes <span class="op">=</span> <span class="fl">1.1</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span>                              <span class="co"># note that sigma_L is symmetric</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> state space model [3,3] with s = 6 states</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             s[1]        s[2]         s[3]        s[4]         s[5]        s[6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1]  0.01321050  0.31123733 -0.009441997 -0.09718823  0.098663861  0.15103045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2] -0.09212396 -0.24171562  0.201285623  0.06670158  0.461532132 -0.01896857</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3] -0.03836733  0.03447621 -0.078772912 -0.39696322 -0.168941640 -0.15171288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4] -0.10120253  0.16971301 -0.119165128  0.15511276 -0.099681676 -0.13453779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[5] -0.27816388 -0.01823292  0.170094401 -0.15004522  0.072039933 -0.10276843</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[6]  0.19514689  0.19281588  0.006588536  0.09156063  0.127785700  0.13922648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1]  0.05765478  0.08948316 -0.015088562 -0.04971894 -0.101702893  0.10983098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2] -0.06704662  0.45932249 -0.096246648  0.13594879 -0.019748603  0.10850459</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  0.09701793  0.09426726 -0.188310146  0.17387984  0.003516328 -0.12204231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               u[1]        u[2]        u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1]  0.2392809195 -0.14529553 -0.17589796</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2]  0.0271601047  0.17081427  0.03018147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3]  0.1858441523 -0.06684824 -0.34365827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4] -0.1170055161 -0.29034523  0.16466124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[5]  0.2913418368  0.23268445  0.15136692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[6] -0.0007903322  0.03729747 -0.04250798</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1]  1.0000000000  0.00000000  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2]  0.0000000000  1.00000000  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  0.0000000000  0.00000000  1.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Left square root of noise covariance Sigma:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             u[1]       u[2]        u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[1] -0.35636364 0.02519447  0.12560560</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[2]  0.02519447 0.08273967  0.02693086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[3]  0.12560560 0.02693086 -0.31980116</span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span><span class="op">)</span> <span class="co"># noise covariance Sigma</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]         [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.143406569 -0.003511144 -0.084251576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.003511144  0.008205885 -0.003219702</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.084251576 -0.003219702  0.118774819</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># tmpl_DDLC #############################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create a DDLC parametrization of a neighborhood of this model</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu">tmpl_DDLC</span><span class="op">(</span><span class="va">model</span>, balance <span class="op">=</span> <span class="st">'lyapunov'</span>, sigma_L <span class="op">=</span> <span class="st">'chol'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># for th = 0, we get the original model (in balanced form)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="fill_template.html">fill_template</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">tmpl</span><span class="op">$</span><span class="va">n.par</span><span class="op">)</span>, <span class="va">tmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span>                                <span class="co"># note that sigma_L is lower triangular</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> state space model [3,3] with s = 6 states</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             s[1]        s[2]        s[3]         s[4]         s[5]         s[6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1] -0.01648914 -0.48227471  0.31563376 -0.065616269 -0.074004828 -0.008931280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2] -0.26148205 -0.22750392  0.38241885  0.331408414  0.056781725  0.023382218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3] -0.05050684  0.03964702  0.28414112 -0.269525477  0.084887279 -0.046339198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4]  0.01846800 -0.09502178  0.53136447  0.243060472  0.034518652 -0.040168945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[5] -0.06189414 -0.03044651 -0.05610569  0.157839698 -0.019773594  0.292895352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[6]  0.02372034  0.04524106  0.01123395  0.083903181 -0.045606496 -0.204333789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1] -0.02524009  0.12191751 -0.02148435  0.113429905 -0.015047579 -0.010977896</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2]  0.30329879  0.11155597  0.11506967 -0.001310153 -0.002854065  0.003859815</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  0.20770309 -0.18088368 -0.11623649  0.050838070  0.009918857 -0.004657147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              u[1]         u[2]         u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[1] -0.162079637  0.059570234  0.287526328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[2] -0.129839902  0.152593509 -0.171949970</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[3]  0.178612895  0.168350234  0.047665038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[4]  0.046270200 -0.094024289 -0.009699282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[5]  0.012618269 -0.002026864  0.007599202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s[6] -0.003635076  0.005888528  0.004167705</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[1]  1.000000000  0.000000000  0.000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[2]  0.000000000  1.000000000  0.000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x[3]  0.000000000  0.000000000  1.000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Left square root of noise covariance Sigma:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              u[1]        u[2]      u[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[1]  0.378690598  0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[2] -0.009271802  0.09011059 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> u[3] -0.222481299 -0.05862247 0.2565936</span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sigma_L</span><span class="op">)</span>  <span class="co"># however Sigma is the same as above</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]         [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.143406569 -0.003511144 -0.084251576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.003511144  0.008205885 -0.003219702</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.084251576 -0.003219702  0.118774819</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#' apply a "small" state transformation T = (diag(s)+eps*X)</span></span></span>
<span class="r-in"><span><span class="va">eps</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sys</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">sys</span></span></span>
<span class="r-in"><span><span class="va">d_sys</span> <span class="op">=</span> <span class="fu">state_trafo</span><span class="op">(</span><span class="va">sys</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">s</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="va">eps</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">s</span>, ncol <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d_pi</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">d_sys</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">eps</span></span></span>
<span class="r-in"><span><span class="co"># The vector d_pi is (close to) an element of the tangent space</span></span></span>
<span class="r-in"><span><span class="co"># of the set of models, which are generated by a state transformation</span></span></span>
<span class="r-in"><span><span class="co"># of the reference model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># by construction d_pi is (close to) orthogonal to tmpl$H</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">d_pi</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tmpl</span><span class="op">$</span><span class="va">H</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">m</span><span class="op">+</span><span class="va">s</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.567456e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the tmpl_DDLC routine may fail in some exceptional cases</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="stspmod.html">stspmod</a></span><span class="op">(</span>sys <span class="op">=</span> <span class="fu">stsp</span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">s</span>, ncol <span class="op">=</span> <span class="va">s</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span><span class="op">*</span><span class="va">s</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">s</span>, ncol <span class="op">=</span> <span class="va">m</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span><span class="op">*</span><span class="va">s</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">m</span>, ncol <span class="op">=</span> <span class="va">s</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                sigma_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For this model "tmpl_DLLC" issues a warning.</span></span></span>
<span class="r-in"><span><span class="va">junk</span> <span class="op">=</span> <span class="fu">tmpl_DDLC</span><span class="op">(</span><span class="va">model</span>, sigma_L <span class="op">=</span> <span class="st">'chol'</span>, balance <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The tangent space of the equivalence class does not have dimension s^2=9 (sv[1]=2.60272101527713, sv[9]=4.98973089849112e-17)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># tmpl_GRAM #############################################</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="fill_template.html">fill_template</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">tmpl</span><span class="op">$</span><span class="va">n.par</span><span class="op">)</span>, <span class="va">tmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">=</span> <span class="fu">tmpl_GRAM</span><span class="op">(</span><span class="va">model</span>, sigma_L <span class="op">=</span> <span class="st">'chol'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="fill_template.html">fill_template</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">tmpl</span><span class="op">$</span><span class="va">n.par</span><span class="op">)</span>, <span class="va">tmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check grammians</span></span></span>
<span class="r-in"><span><span class="va">gr</span> <span class="op">=</span> <span class="fu">grammians</span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">sys</span>, <span class="st">'lyapunov'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="va">P</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="va">Q</span></span></span>
<span class="r-in"><span><span class="co"># P=Q=diag() should hold!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">P</span>, <span class="va">P</span><span class="op">-</span><span class="va">Q</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]     [,2]     [,3]     [,4]    [,5]     [,6] [,7] [,8] [,9] [,10]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.142761 0.000000 0.000000 0.000000 0.00000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.000000 0.098768 0.000000 0.000000 0.00000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.000000 0.000000 0.071289 0.000000 0.00000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.000000 0.000000 0.000000 0.034166 0.00000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.000000 0.000000 0.000000 0.000000 0.00199 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 0.000000 0.000000 0.000000 0.000000 0.00000 0.000628    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,11] [,12]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]     0     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now consider a model close to the reference model</span></span></span>
<span class="r-in"><span><span class="va">d_th</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">tmpl</span><span class="op">$</span><span class="va">n.par</span>, sd <span class="op">=</span> <span class="va">eps</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d_model</span> <span class="op">=</span> <span class="fu"><a href="fill_template.html">fill_template</a></span><span class="op">(</span><span class="va">d_th</span>, <span class="va">tmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d_sys</span> <span class="op">=</span> <span class="va">d_model</span><span class="op">$</span><span class="va">sys</span></span></span>
<span class="r-in"><span><span class="va">gr</span> <span class="op">=</span> <span class="fu">grammians</span><span class="op">(</span><span class="va">d_sys</span>, <span class="st">'lyapunov'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d_P</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="va">P</span> <span class="op">-</span> <span class="va">P</span></span></span>
<span class="r-in"><span><span class="va">d_Q</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="va">Q</span> <span class="op">-</span> <span class="va">Q</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the "disturbed" system should still be approximately balanced!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">d_P</span>, <span class="va">d_P</span> <span class="op">-</span> <span class="va">d_Q</span><span class="op">)</span><span class="op">/</span><span class="va">eps</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1]     [,2]     [,3]     [,4]     [,5]     [,6] [,7] [,8] [,9] [,10]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.62452 0.000000 0.000000 0.000000 0.000000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.00000 0.432345 0.000000 0.000000 0.000000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.00000 0.000000 0.189838 0.000000 0.000000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.00000 0.000000 0.000000 0.054704 0.000000 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.00000 0.000000 0.000000 0.000000 0.013332 0.000000    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 0.00000 0.000000 0.000000 0.000000 0.000000 0.001229    0    0    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,11] [,12]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]     0     0</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://scholar.google.com/citations?user=-Ytb9BYAAAAJ" class="external-link">Wolfgang Scherrer</a>, <a href="https://ch.linkedin.com/in/bernd-funovits-phd-cfa-a8215016" class="external-link">Bernd Funovits</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

